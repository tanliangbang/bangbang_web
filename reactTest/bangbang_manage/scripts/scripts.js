"use strict";function checkIsFill(){var e=!0;return $(".otherFields").each(function(){var t=$(this).attr("data-type"),n=$(this).attr("data-isNeed"),a=$(this).find("input");if(1==n)switch(t){case"text":case"number":e=isEmpty(a.val())?e&&!1:e&&!0;break;case"file":isEmpty(a.attr("url"))?(e=e&&!1,alert("请选择照片")):e=e&&!0}else e=e&&!0,a.removeAttr("required")}),e}function isCurrClick(e){var t=e.className;t=t.split(" ");for(var n=0;n<t.length;n++)if("imgPreview"==t[n])return!0;return!1}function uploadImg(e){if($("input[name*='resImg']").get(0).files[0]){var e=e;$.ajaxFileUpload({url:"/api/upload/uploadImg",secureuri:!1,fileElementId:"resImg",dataType:"jsonp",jsonp:"jsoncallback",jsonpCallback:"success_jsonpCallback",success:function(t,n){e(t)},error:function(e,t,n){alert("上传失败，请重新上传")}})}}angular.module("reactTestApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/addArticle",{templateUrl:"views/article/addArticle.html",controller:"AddArticleCtrl",controllerAs:"addArticle"}).when("/resAdd",{templateUrl:"views/res/resAdd.html",controller:"ResAddCtrl",controllerAs:"resAdd"}).when("/resContentList",{templateUrl:"views/res/resContentList.html",controller:"ResContentListCtrl",controllerAs:"resContentList"}).when("/resAddContent",{templateUrl:"views/res/resAddContent.html",controller:"ResAddContentCtrl",controllerAs:"resAddContent"}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}]),angular.module("reactTestApp").controller("MainCtrl",["$http",function(e){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("reactTestApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("reactTestApp").controller("AddArticleCtrl",["$scope","$http",function(e,t){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],UE.getEditor("article"),e.articleDate={},$(".pickerDate").datetimepicker(),e.addArticleBtn=function(){e.articleDate.content=UE.getEditor("article").getContent(),t.post("/api/article/addArticle",e.articleDate,function(e){console.log(e)})},e.$on("$locationChangeSuccess",function(){UE.getEditor("article").destroy()})}]),angular.module("reactTestApp").controller("ResAddCtrl",["$scope","$http","$routeParams","$location",function(e,t,n,a){function i(e){var t=[];e=JSON.parse(e);for(var n in e)t.push(r(n,e[n]));return t}function r(e,t){var n={name:e};for(var a in t)n[a]=t[a];return n}function s(e){return{dataChinaName:e.dataChinaName,name:e.name,brief:e.brief,dataType:e.dataType,dataIsNeed:e.dataIsNeed,isShow:e.isShow,enumVal:e.enumVal}}function o(e){for(var t="{",n=0;n<e.length;n++)t=t+'"'+e[n].name+'":{"dataChinaName":"'+e[n].dataChinaName+'","dataType":"'+e[n].dataType+'","dataIsNeed":"'+e[n].dataIsNeed+'","brief":"'+e[n].brief+'","isShow":"'+e[n].isShow+'","enumVal":"'+e[n].enumVal+'"},';return t=t.substr(0,t.length-1)+"}"}function l(e,t){e.dataChinaName=t.dataChinaName,e.name=t.name,e.brief=t.brief,e.dataType=t.dataType,e.dataIsNeed=t.dataIsNeed,e.isShow=t.isShow}this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var c=["text","file","date","time","boolean","textarea","filte","enum","select"];e.id=n.id,e.fieldTypes=c,e.showAddFieldFn=function(){e.showMask(),e.fileFormShow=!0,e.dataChinaName="",e.name="",e.brief="",e.dataType="text",e.isShow="1",e.dataIsNeed="1",e.enumVal=""};var d=null;e.id?t.get("/api/res/getRes",{params:{id:e.id}}).success(function(t){d=t.data[0],e.fields=i(d.type_specification),e.res_desc=d.cname,e.res_name=d.name}).error(function(e,t,n,a){defer.reject(e)}):e.fields=[];var u=[],p={};e.addFileBtnFn=function(){if(!(isEmpty(e.name)||isEmpty(e.brief)||isEmpty(e.dataChinaName))){for(var t=e.fields,n=0;n<t.length;n++)if(t[n].name==e.name&&e.currChangeFieldIndex!=n)return void alert("字段名不能重复");e.closeMask(),e.isEditField?(e.isEditField=!1,p=s(e),e.fields[e.currChangeFieldIndex]=p,e.fileFormShow=!1):(u=e.fields,p=s(e),u.push(p),e.fields=u,e.fileFormShow=!1)}},e.editResFieldFn=function(){e.showMask(),e.fileFormShow=!0,"enum"==this.field.dataType||"select"==this.field.dataType?(e["enum"]=!0,e.enumVal=this.field.enumVal):(e["enum"]=!1,e.enumVal=""),l(e,this.field),e.currChangeFieldIndex=this.$index,e.isEditField=!0},e.delResFieldFn=function(){for(var t=e.fields,n=0;n<t.length;n++)t[n].name==this.field.name&&t.splice(n,1)},e.closeCurrMask=function(){e.fileFormShow=!1,e.closeMask()},e.addResFn=function(){var n=e.res_desc,i=e.res_name;if(!isEmpty(n)&&!isEmpty(i)){if(!e.fields||e.fields.length<1)return void alert("请添加字段");var r=o(e.fields);e.id?t.post("/api/res/updateRes",{id:e.id,name:i,cname:n,type_specification:r}).success(function(e){a.path("resList")}):t.post("/api/res/addRes",{name:i,cname:n,type_specification:r}).success(function(e){a.path("resList")})}}}]),angular.module("reactTestApp").controller("ResContentListCtrl",["$scope","$http","$routeParams","$location",function(e,t,n,a){function i(e,n,a){var i=n.itemsPerPage*(n.currentPage-1);i||(i=0),r(function(){t.get("/api/res/getResContentList",{params:{name:e.type,start:i,size:n.itemsPerPage}}).success(function(t,a,i,r){t=t.data,e.currTypeContents=t.content,n.totalItems=t.pageTotal}).error(function(e,t,n,a){defer.reject(e)})})}function r(n){t.get("/api/res/getRes?id="+e.id).success(function(t){t=t.data,e.currItem=t[0],e.typeItems=JSON.parse(e.currItem.type_specification),n()}).error(function(e,t,n,a){defer.reject(e)})}this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],e.type=n.type,e.id=n.id,window.localStorage.currentPage=1,e.paginationConf={currentPage:1,totalItems:0,itemsPerPage:5,pagesLength:15,perPageOptions:[10,20,30,40,50],onChange:function(){var t=this;1!=window.localStorage.currentPage?this.currentPage=parseInt(window.localStorage.currentPage):window.localStorage.currentPage=this.currentPage,e.paginationObj=this,i(e,t,e.currItem)}},e.delResContent=function(n){confirm("确认要删除？")&&t.post("/api/res/delResContent",{id:e.currTypeContents[n].id,type:e.type}).success(function(){e.currTypeContents.splice(n,1),alert("删除成功")}).error(function(e){alert("删除失败")})},e.editResFn=function(t){a.path("resAddContent").search("type="+e.type+"&id="+e.id+"&resContentId="+e.currTypeContents[t].id)},e.resDeleteFn=function(){if(confirm("确认要删除？")){t.post("/api/res/delRes",{name:n.type,id:e.id}).success(function(){alert("删除成功"),a.path("/"),window.location.reload()}).error(function(e){alert("删除失败")})}},e.editResContentFn=function(){a.path("resAdd").search("id="+e.id)}}]),angular.module("reactTestApp").controller("ResAddContentCtrl",["$scope","$http","$routeParams","$location",function(e,t,n,a){function i(i){e.resContentId?t.post("/api/res/UpdateResContent",{resContentId:e.resContentId,onLine:e.otherField.isOnLine,startTime:e.otherField.startTime,endTime:e.otherField.endTime,content:JSON.stringify(i),name:r.name}).success(function(){a.path("resContentList").search("type="+r.name+"&id="+n.id)}).error(function(e){alert("failure message:"+JSON.stringify({data:e}))}):t.post("/api/res/addResContent",{onLine:e.otherField.isOnLine,startTime:e.otherField.startTime,endTime:e.otherField.endTime,content:JSON.stringify(i),name:r.name}).success(function(){a.path("resContentList").search("type="+r.name+"&id="+n.id)}).error(function(e){alert("failure message:"+JSON.stringify({data:e}))})}this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var r=null,s=null;$(".pickerDate").datetimepicker({format:"yyyy-mm-dd",beforeShow:function(){setTimeout(function(){$("#ui-datepicker-div").css("z-index",1e3)},100)}}),e.$on("$locationChangeSuccess",function(){for(var e=UE.myObj,t=0;t<e.length;t++)UE.getEditor("my"+e[t]).destroy()});var o=n.id,l=e.resContentId=n.resContentId;t.get("/api/res/getRes?id="+o).success(function(a,i,o,c){a=a.data,e.currResType=r=a[0],s=JSON.parse(r.type_specification),UE.myObj=[];for(var d in s)"textarea"==s[d].dataType&&UE.myObj.push(d);l?t.get("/api/res/getResContentById?id="+l+"&name="+n.type).success(function(t,n,a,i){t=t.data;var r=e.otherField=t[0];r.startTime=changeTime(r.startTime,"-"),r.endTime=changeTime(r.endTime,"-"),r.isOnLine=r.isOnLine+"";var o=[];for(var l in s)o.push(r.content);e.editorContent=o,e.fields=s}):(e.fields=s,e.otherField={},e.otherField.isOnLine="1")}).error(function(e,t,n,a){defer.reject(e)}),e.submitResFn=function(){var e={},t="";if(checkIsFill()){for(var n in s)if("text"==s[n].dataType||"time"==s[n].dataType||"number"==s[n].dataType)t="input[name="+n+"]",e[n]=$(t).val();else if("boolean"==s[n].dataType||"filte"==s[n].dataType||"select"==s[n].dataType)t="select[name="+n+"]",e[n]=$(t).val();else if("file"==s[n].dataType)t="input[name="+n+"]",e[n]=$(t).attr("url");else if("date"==s[n].dataType)t="input[name="+n+"]",t=$(t).val(),e[n]=t;else if("textarea"==s[n].dataType)t="textarea[name="+n+"]",e[n]=UE.getEditor("my"+n).getContent();else if("enum"==s[n].dataType){t="input[type=checkbox]";for(var a="",r=0;r<$(t).length;r++)$(t)[r].checked&&(a=a+$(t)[r].name+",");a=a.substr(0,a.length-1),e[n]=a}i(e)}}}]);var app=angular.module("reactTestApp"),dateNI='fieldType=="date"',date="<div ng-if="+dateNI+'  class="form-group"><label class="col-sm-3 control-label">{{desc}}：</label><div class="col-sm-3"><input class="form-control"  ng-click="dateSeleFn($event)" value="{{content}}"  name="{{name}}"  type="text" placeholder="{{name}}"  required /></div></div>',textNI='fieldType=="text"',textInput="<div ng-if="+textNI+'  class="form-group"><label class="col-lg-3 col-md-3 control-label">{{desc}}：</label><div class="col-lg-9 col-md-9"><input class="form-control"  value="{{content}}" name="{{name}}"  type="text" placeholder="{{name}}"  required /></div></div>',numberNI='fieldType=="number"',number="<div ng-if="+numberNI+'  class="form-group"><label class="col-sm-3 control-label">{{desc}}：</label><div class="col-sm-3"><input class="form-control"  value="{{content}}"  name="{{name}}"  type="number" placeholder="{{name}}"  required /></div></div>',booleanNI='fieldType=="boolean"',boolean="<div ng-if="+booleanNI+'  class="form-group"><label class="col-sm-3 control-label">{{desc}}：</label><div class="col-sm-3"><select  class="form-control" ng-model="content"  name="{{name}}"><option value="1" >是</option><option value="0" selected>否</option></select></div></div>',timeIn='fieldType=="time"',time="<div ng-if="+timeIn+'  class="form-group"><label class="col-sm-3 control-label">{{desc}}：</label><div class="col-sm-3"><input class="form-control timeClass" ng-click="timeClickFn($event)" value="{{content}}"  name="{{name}}"  type="text" placeholder="{{name}}"  required /></div></div>',fileNI='fieldType=="file"',file=" <div ng-if="+fileNI+'  class="form-group tAlign"><label class="col-sm-3 control-label">{{desc}}：</label><div  class="imgPreview" ng-click="addFileFn($event)"><img ng-if="content" ng-src="{{content}}"><i ng-if="!content" class="fa fa-plus addBtn"></i></div><div class="btn uploadBtn"    ng-click="uploadFiles($event)"> 上传</div><input onchange="getImgDate(this)" url="{{content}}" class="fileInput none" id="{{name}}" name="{{name}}" type="file"></div>',textareaNI='fieldType=="textarea"',textarea="<div ng-if="+textareaNI+'  class="form-group"><label class="col-sm-3 control-label">{{desc}}：</label><div class="col-sm-9"><script id="my{{name}}" type="text/plain" style="width:100%;height:800px;position:relative;" ></script></div></div>',filteNI='fieldType=="filte"',filte="<div ng-if="+filteNI+'  class="form-group"><label class="col-sm-3 control-label">{{desc}}:</label><div class="col-sm-5"><select class="form-control filteSelect" name="{{name}}" ng-model="filteVal"  ><option value="{{filte.id}}" ng-selected="filteVal==filte.id"  ng-repeat="filte in filteList">{{filte.cname}}</option></select><a ng-click="addFileBtn()" ng-show="showSelect" class="btn btn-success hover-link colorbox-button cboxElement filteBtn" title="添加"><i class="fa fa-plus fa-1x"></i></a>',enumNI='fieldType=="enum"',enumType="<div ng-if="+enumNI+'  class="form-group"><label class="col-sm-3 control-label">{{desc}}：</label><div class="col-sm-9"><span ng-repeat="enumVal in enumVals" class="enumClass">{{enumVal}}: <input name="{{enumVal}}" ng-checked="{{content[$index]}}"    type="checkbox"   /></span> </div></div>',selectIN='fieldType=="select"',select="<div ng-if="+selectIN+'  class="form-group"><label class="col-sm-3 control-label">{{desc}}:</label><div class="col-sm-5"><select class="form-control filteSelect" ng-model="operaVal"  name="{{name}}"   ><option   ng-repeat="select in selectList">{{select}}</option></select></div></div>';app.directive("field",["$timeout","$http",function(e,t){return{restrict:"AEC",scope:{temp:"@"},link:function(n,a,i){if(n.fieldType=i.type,n.name=i.name,n.desc=i.desc,n.num=i.num,"date"!=i.type||isEmpty(i.content))if("boolean"==i.type&&isEmpty(i.content))n.content="0";else if("enum"==i.type){for(var r=n.enumVals=i.enumval.split(","),s=n.content=i.content.split(","),o=[],l=0;l<r.length;l++)for(var c=0;c<s.length;c++){if(r[l]==s[c]){o[l]=!0;break}o[l]=!1}n.content=o}else"select"==i.type?(n.selectList=i.enumval.split(","),n.operaVal=n.selectList[0],i.content&&(n.operaVal=i.content)):"textarea"==n.fieldType?e(function(){UE.getEditor("my"+i.name),e(function(){UE.getEditor("my"+i.name).setContent(i.content,!1)},100)},100):"filte"==n.fieldType?t.get(apiUrl+"/res/filteList",{params:{}}).success(function(e,t,a,r){console.log(n);var s={cname:"所有",content:"",id:-1,name:"所有"};e.unshift(s),n.filteList=e,i.content?n.filteVal=i.content:n.filteVal=-1}).error(function(e,t,n,a){}):n.content=i.content;else n.content=changeTime(i.content,"-");n.isNeed=i.isNeed,n.addFileFn=function(e){var t=e.target,n=null;n=isCurrClick(t)?t:t.parentNode,n.nextSibling.nextSibling.click()},n.uploadFiles=function(e){var t=e.target;t.nextSibling.setAttribute("name","resImg"),t.nextSibling.setAttribute("id","resImg"),uploadImg(function(e){t.nextSibling.setAttribute("url",e),t.nextSibling.setAttribute("name",n.name),t.nextSibling.setAttribute("id",n.name),t.style.display="none"},n.$root)},n.dateSeleFn=function(e){var t=e.target;$(t).datetimepicker({timeFormat:"hh:mm:ss",dateFormat:"yy-mm-dd",changeYear:!0,beforeShow:function(){setTimeout(function(){$("#ui-datepicker-div").css("z-index",1e3)},100)}}),$(t).focus()},n.timeClickFn=function(e){var t=e.target;$(t).timepicker({showSecond:!0,timeFormat:"hh:mm:ss"}),$(t).focus()}},template:select+textInput+file+date+time+number+boolean+textarea+enumType+filte}}]),app.directive("date",function(){return{restrict:"AEC",scope:{value:"@"},link:function(e,t,n){e.value=changeTime(n.value,"-"),e.$watch("value",function(t,a){0!=n.value?e.value=changeTime(n.value,"-"):e.value=""})},template:"<span>{{value}}</span>"}});var app=angular.module("reactTestApp");app.directive("datetimepicker",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){$(t).datetimepicker({timeFormat:"hh:mm:ss",dateFormat:"yy-mm-dd",changeYear:!0,beforeShow:function(){setTimeout(function(){$("#ui-datepicker-div").css("z-index",1e3)},100)}}),setTimeout(function(){a.$viewValue&&a.$setViewValue(new Date(a.$viewValue).getTime())},100),t[0].onchange=function(t){a.$setViewValue(t.timeStamp),e.$apply()}}}}),app.directive("mask",function(){return{restrict:"AEC",link:function(e,t,n){e.showMask=function(){this.maskShow=!0},e.closeMask=function(){this.maskShow=!1}},template:'<div ng-show="maskShow" class="Mask"></div>'}});var app=angular.module("reactTestApp");app.directive("pagination",function(){return{template:'<ul class="pagination"><li ng-repeat="item in pageList track by $index" ng-class="{active: item == conf.currentPage, separate: item == \'...\'}"  ng-click="changeCurrentPage(item)"> <a href=""> {{item}}</a> </li>  <li class="pageSize">每页显示：<select  ng-model="conf.itemsPerPage" ng-options="option for option in conf.perPageOptions "></select>  条</li></ul>',restrict:"EA",replace:!0,scope:{conf:"="},link:function(e,t,n){function a(t,n){e.conf.currentPage=parseInt(e.conf.currentPage)?parseInt(e.conf.currentPage):1,e.conf.totalItems=parseInt(e.conf.totalItems)?parseInt(e.conf.totalItems):0,e.conf.itemsPerPage=parseInt(e.conf.itemsPerPage)?parseInt(e.conf.itemsPerPage):15,e.conf.numberOfPages=Math.ceil(e.conf.totalItems/e.conf.itemsPerPage),e.conf.currentPage<1&&(e.conf.currentPage=1),e.conf.numberOfPages>0&&e.conf.currentPage>e.conf.numberOfPages&&(e.conf.currentPage=e.conf.numberOfPages),e.jumpPageNum=e.conf.currentPage;for(var a,i=e.conf.perPageOptions.length,r=0;r<i;r++)e.conf.perPageOptions[r]==e.conf.itemsPerPage&&(a=!0);if(a||e.conf.perPageOptions.push(e.conf.itemsPerPage),e.conf.perPageOptions.sort(function(e,t){return e-t}),e.pageList=[],e.conf.numberOfPages<=e.conf.pagesLength)for(r=1;r<=e.conf.numberOfPages;r++)e.pageList.push(r);else{var s=(e.conf.pagesLength-1)/2;if(e.conf.currentPage<=s){for(r=1;r<=s+1;r++)e.pageList.push(r);e.pageList.push("..."),e.pageList.push(e.conf.numberOfPages)}else if(e.conf.currentPage>e.conf.numberOfPages-s){for(e.pageList.push(1),e.pageList.push("..."),r=s+1;r>=1;r--)e.pageList.push(e.conf.numberOfPages-r);e.pageList.push(e.conf.numberOfPages)}else{for(e.pageList.push(1),e.pageList.push("..."),r=Math.ceil(s/2);r>=1;r--)e.pageList.push(e.conf.currentPage-r);for(e.pageList.push(e.conf.currentPage),r=1;r<=s/2;r++)e.pageList.push(e.conf.currentPage+r);e.pageList.push("..."),e.pageList.push(e.conf.numberOfPages)}}e.conf.onChange&&(n!=t&&0==n[0]||e.conf.onChange()),e.$parent.conf=e.conf}e.changeCurrentPage=function(t){window.localStorage.currentPage=1,"..."!=t&&(e.conf.currentPage=t)},e.conf.pagesLength=parseInt(e.conf.pagesLength)?parseInt(e.conf.pagesLength):9,e.conf.pagesLength%2===0&&(e.conf.pagesLength=e.conf.pagesLength-1),e.conf.perPageOptions||(e.conf.perPageOptions=[10,15,20,30,50]),e.prevPage=function(){e.conf.currentPage>1&&(e.conf.currentPage-=1)},e.nextPage=function(){e.conf.currentPage<e.conf.numberOfPages&&(e.conf.currentPage+=1)},e.jumpToPage=function(){e.jumpPageNum=e.jumpPageNum.replace(/[^0-9]/g,""),""!==e.jumpPageNum&&(e.conf.currentPage=e.jumpPageNum)},e.$watch(function(){e.conf.totalItems||(e.conf.totalItems=0);var t=e.conf.totalItems+" "+e.conf.currentPage+" "+e.conf.itemsPerPage;return t},a)}}}),angular.module("reactTestApp").controller("bodyController",["$scope","$http",function(e,t){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],t.get("/api/res/getResList").success(function(t,n,a,i){console.log(t),e.resList=t.data}).error(function(e,t,n,a){defer.reject(e)}),e.changeSub=function(e){var t=null;t="A"==e.target.tagName?$(e.target).next():$(e.target).parent().next(),"none"==t.css("display")?(t.css("display","block"),t.prev().children().addClass("rotateM90")):(t.css("display","none"),t.prev().children().removeClass("rotateM90"))}}]);